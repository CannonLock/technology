<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Acceptance Testing - OSG Technology Area</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Acceptance Testing";
    var mkdocs_page_input_path = "release/acceptance-testing.md";
    var mkdocs_page_url = "/release/acceptance-testing/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Technology Area</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
  
    <a class="" href="../..">Home</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Software</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../software/development-process/">Development Process</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/markdown-migration/">Migrating Documents to Markdown</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/koji-workflow/">Koji Workflow</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/new-team-member/">New Team Member</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/repository-management/">Repository Management</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/ce-test-scaling/">CE Scale Testing</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/rpm-development-guide/">RPM Development Guide</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/quilt/">Using Quilt</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/upcoming-to-main/">Upcoming to Main</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/software-support/">Software Support</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/effort-tracking/">Effort Tracking</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/release-planning/">Release Planning</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/globus-mass-update-procedure/">Globus Mass Update Procedure</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/git-software-development/">Git Software Development Process</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/osg-build-tools/">OSG Build Tools</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/resurrecting-epel-packages/">Resurrecting Epel Packages</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/koji-mass-rebuilds/">Koji Mass Rebuilds</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/create-vo-client/">Creating the VO Client Package</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/pki-overview/">PKI Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/ipv6-testing/">IPv6 Testing</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Release</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../cut-sw-release/">How to Cut a Release</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../cut-data-release/">How to Cut a Data Release</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../release-policy/">Release Policy</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../release-schedule/">Release Schedule</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../new-release-series/">New Release Series</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../old-release-removal/">Old Release Series Removal</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../condor-itb-testing/">HTCondor Prerelease Testing</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../empty-pkgs/">Empty Packages</a>
  
        </li>
        <li class=" current">
          
  
    <a class="current" href="./">Acceptance Testing</a>
  
  <ul class="subnav">
      
    <li class="toctree-l3"><a href="#acceptance-testing">Acceptance Testing</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#cvmfs">CVMFS</a></li>
        
            <li><a class="toctree-l4" href="#gratia-probe">Gratia Probe</a></li>
        
            <li><a class="toctree-l4" href="#gsi-openssh">GSI OpenSSH</a></li>
        
            <li><a class="toctree-l4" href="#htcondor-ce-collector-wip">HTCondor-CE Collector (WIP)</a></li>
        
            <li><a class="toctree-l4" href="#rsv">RSV</a></li>
        
            <li><a class="toctree-l4" href="#slurm">Slurm</a></li>
        
            <li><a class="toctree-l4" href="#vo-client">VO Client</a></li>
        
            <li><a class="toctree-l4" href="#voms-admin-server">VOMS Admin Server</a></li>
        
            <li><a class="toctree-l4" href="#xrootd-voms-testing">XRootD VOMS Testing</a></li>
        
            <li><a class="toctree-l4" href="#xrootd-plugins">XRootD Plugins</a></li>
        
        </ul>
    

  </ul>
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Policy</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../policy/gums-retire/">GUMS Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/bestman2-retire/">BeStMan2 Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/voms-admin-retire/">VOMS Admin Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/release-series/">Release Series Support</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/globus-toolkit/">Globus Toolkit Support</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/external-oasis-repos/">OASIS Repository Mirroring</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/flexible-release-model/">Flexible Release Model</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Infrastructure</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-restore-recipe/">Koji Restore Recipe</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-hub-setup/">Koji-Hub Setup</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-inf-overview/">Koji Infrastructure Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-policy-writing/">Koji Policy Writing</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/madison-itb/">Madison ITB</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Documentation</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../documentation/writing-documentation/">Writing Documentation</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Historical Information</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-initial-install/">Koji Initial Install</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Historical Transitions</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../projects/sha2-support/">SHA-2 Support</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Technology Area</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Release &raquo;</li>
        
      
    
    <li>Acceptance Testing</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/edit/master/docs/release/acceptance-testing.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="acceptance-testing">Acceptance Testing<a class="headerlink" href="#acceptance-testing" title="Permanent link">&para;</a></h1>
<p>The OSG Release Team collects and maintains testing procedures for major components in the OSG Sofware Stack. These test should verify that basic functionality of the component works in typically deployed configurations.</p>
<h2 id="cvmfs">CVMFS<a class="headerlink" href="#cvmfs" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This acceptance testing recipe was created when access to a machine with sufficient disk space to make a complete replica of OASIS was not available.</p>
</div>
<h3 id="creating-a-cvmfs-repository-server-stratum-0">Creating a CVMFS Repository Server (Stratum 0)<a class="headerlink" href="#creating-a-cvmfs-repository-server-stratum-0" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Disable SELinux by setting the following in <code>/etc/selinux/config</code>.</p>
<div class="codehilite"><pre><span></span>SELINUX=disabled
</pre></div>


</li>
<li>
<p>Check kernel version.</p>
<div class="codehilite"><pre><span></span><span class="go">uname -a</span>
</pre></div>


</li>
<li>
<p>CVMFS for EL7 requires OverlayFS (as of kernel version 4.2.x). If default kernel is &lt;= 4.2.x, update kernel.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> rpm --import &lt;https://www.elrepo.org/RPM-GPG-KEY-elrepo.org&gt;
<span class="gp">root@host #</span> rpm -Uvh &lt;http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm&gt;
<span class="gp">root@host #</span> yum install yum-plugin-fastestmirror
<span class="gp">root@host #</span> yum --enablerepo<span class="o">=</span>elrepo-kernel install kernel-ml
</pre></div>


</li>
<li>
<p>Select updated kernel by editing <code>/etc/default/grub</code>.</p>
<div class="codehilite"><pre><span></span>GRUB_DEFAULT=0
</pre></div>


<p>and run:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> grub2-mkconfig -o /boot/grub2/grub.cfg
</pre></div>


</li>
<li>
<p>Reboot system. </p>
</li>
<li>
<p>Check kernel version again and make sure SELinux is disabled.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> uname -a
<span class="gp">root@host #</span> sestatus
</pre></div>


</li>
<li>
<p>If kernel &gt;= 4.2 and SELinux is disabled, then update system and install CVMFS server and client packages.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> yum update
<span class="gp">root@host #</span> yum install epel-release
<span class="gp">root@host #</span> yum install yum-plugin-priorities
<span class="gp">root@host #</span> rpm -Uvh &lt;https://repo.grid.iu.edu/osg/3.3/osg-3.3-el7-release-latest.rpm&gt;
<span class="gp">root@host #</span> yum install cvmfs cvmfs-server
</pre></div>


</li>
<li>
<p>Configure web server and start it up. Edit <code>/etc/httpd/conf.d/cvmfs.conf</code>:</p>
<div class="codehilite"><pre><span></span>Listen 8000
KeepAlive On
</pre></div>


<p>and run:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> chkconfig httpd on
<span class="gp">root@host #</span> service httpd start
</pre></div>


</li>
<li>
<p>Make new repository.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> cvmfs_server mkfs test.cvmfs-stratum-0.novalocal
</pre></div>


</li>
<li>
<p>Run transaction on new repository to enable write access.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> cvmfs_server transaction test.cvmfs-stratum-0.novalocal
</pre></div>


</li>
<li>
<p>Place some sample code in new repository directory and then publish it.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> <span class="nb">cd</span> /cvmfs/test.cvmfs-stratum-0.novalocal
<span class="gp">root@host #</span> vi <span class="o">[</span>bash<span class="se">\_</span>pi.sh<span class="o">](</span>%ATTACHURL%/bash_pi.sh<span class="o">)</span>
<span class="gp">root@host #</span> chmod +x bash<span class="se">\_</span>pi.sh
<span class="gp">root@host #</span> cvmfs<span class="se">\_</span>server publish test.cvmfs-stratum-0.novalocal
</pre></div>


</li>
<li>
<p>Check repository status after publication.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> cvmfs<span class="se">\_</span>server check
<span class="gp">root@host #</span> cvmfs<span class="se">\_</span>server tag
<span class="gp">root@host #</span> wget -qO- &lt;http://localhost:8000/cvmfs/test.cvmfs-stratum-0.novalocal/.cvmfswhitelist%7Ccat&gt; -v
</pre></div>


</li>
<li>
<p>Download a copy of the CVMFS repository's public key e.g., /etc/cvmfs/keys/test.cvmfs-stratum-0.novalocal.pub</p>
</li>
</ol>
<h3 id="creating-a-cvmfs-replica-server-stratum-1">Creating a CVMFS Replica Server (Stratum 1)<a class="headerlink" href="#creating-a-cvmfs-replica-server-stratum-1" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Repeat steps 1 though 8 in the previous section on "Creating a CVMFS Repository Server ". However, now also install <code>mod_wsgi</code>.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> yum install cvmfs cvmfs-server mod<span class="se">\_</span>wsgi
</pre></div>


</li>
<li>
<p>Upload a copy of the CVMFS repository's public key and place in <code>/etc/cvmfs/keys</code> directory. </p>
</li>
<li>
<p>Add replica of the repository.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> cvmfs_server add-replica -o root &lt;http://10.128.3.96:8000/cvmfs/test.cvmfs-stratum-0.novalocal&gt; /etc/cvmfs/keys/test.cvmfs-stratum-0.novalocal.pub
</pre></div>


</li>
<li>
<p>Make a snapshot of the repository.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> cvmfs<span class="se">\_</span>server snapshot test.cvmfs-stratum-0.novalocal
</pre></div>


</li>
</ol>
<h3 id="creating-a-cvmfs-client">Creating a CVMFS client<a class="headerlink" href="#creating-a-cvmfs-client" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Update system and install CVMFS client package.</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> yum update
<span class="gp">root@host #</span> yum install epel-release
<span class="gp">root@host #</span> yum install yum-plugin-priorities
<span class="gp">root@host #</span> rpm -Uvh &lt;https://repo.grid.iu.edu/osg/3.3/osg-3.3-el7-release-latest.rpm&gt;
<span class="gp">root@host #</span> yum install cvmfs
</pre></div>


</li>
<li>
<p>Upload a copy of the CVMFS repository's public key and place in <code>/etc/cvmfs/keys</code> directory.</p>
</li>
<li>
<p>Edit fuse configuration <code>/etc/fuse.conf</code>.</p>
<div class="codehilite"><pre><span></span>user_allow_other
</pre></div>


</li>
<li>
<p>Edit autofs configuration and restart service <code>/etc/auto.master</code>.</p>
<div class="codehilite"><pre><span></span>/cvmfs /etc/auto.cvmfs
</pre></div>


<p>and run:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> service autofs restart
</pre></div>


</li>
<li>
<p>Edit cvmfs configuration (<code>/etc/cvmfs/default.local</code>) to point to replica server.</p>
<div class="codehilite"><pre><span></span><span class="n">CVMFS_SERVER_URL</span><span class="o">=</span><span class="s">&quot;http://10.128.3.97:8000/cvmfs/@fqrn@&quot;</span>
<span class="n">CVMFS_REPOSITORIES</span><span class="o">=</span><span class="s">&quot;test.cvmfs-stratum-0.novalocal&quot;</span>
<span class="n">CVMFS_HTTP_PROXY</span><span class="o">=</span><span class="n">DIRECT</span>
</pre></div>


</li>
<li>
<p>Remove OSG CVMFS configuration file.</p>
<div class="codehilite"><pre><span></span><span class="go">rm /etc/cvmfs/default.d/60-osg.conf</span>
</pre></div>


</li>
<li>
<p>Run CVMFS config probe.</p>
<div class="codehilite"><pre><span></span><span class="go">cvmfs_config probe test.cvmfs-stratum-0.novalocal</span>
</pre></div>


</li>
<li>
<p>Check CVMFS config status.</p>
<div class="codehilite"><pre><span></span><span class="go">cvmfs_config stat -v test.cvmfs-stratum-0.novalocal</span>
</pre></div>


</li>
<li>
<p>Execute sample code published to repository from client.</p>
<div class="codehilite"><pre><span></span><span class="go">/cvmfs/test.cvmfs-stratum-0.novalocal/bash_pi.sh -b 8 -r 5 -s 10000</span>
</pre></div>


</li>
</ol>
<h3 id="creating-an-oasis-client">Creating an OASIS client<a class="headerlink" href="#creating-an-oasis-client" title="Permanent link">&para;</a></h3>
<ol>
<li>Update system and install CVMFS client package.<ul>
<li>yum update</li>
<li>yum install epel-release</li>
<li>yum install yum-plugin-priorities</li>
<li>rpm -Uvh <a href="https://repo.grid.iu.edu/osg/3.3/osg-3.3-el7-release-latest.rpm">https://repo.grid.iu.edu/osg/3.3/osg-3.3-el7-release-latest.rpm</a></li>
<li>yum install osg-oasis </li>
</ul>
</li>
<li>Verify latest versions of cvmfs, cvmfs-config-osg, and cvmfs-x509-helper have been installed. </li>
<li>Edit fuse configuration.<ul>
<li>vi /etc/fuse.conf<ul>
<li>user_allow_other </li>
</ul>
</li>
</ul>
</li>
<li>Edit cvmfs configuration to point to replica server.<ul>
<li>vi /etc/cvmfs/default.local<ul>
<li>CVMFS_REPOSITORIES="`echo $((echo oasis.opensciencegrid.org;echo cms.cern.ch;ls /cvmfs)|sort -u)|tr ' ' ,`"</li>
<li>CVMFS_QUOTA_LIMIT=20000</li>
<li>CVMFS_HTTP_PROXY=DIRECT</li>
</ul>
</li>
</ul>
</li>
<li>Edit autofs configuration and restart service.<ul>
<li>vi /etc/auto.master<ul>
<li>/cvmfs /etc/auto.cvmfs</li>
</ul>
</li>
<li>service autofs restart</li>
</ul>
</li>
<li>Run CVMFS config probe.<ul>
<li>cvmfs_config probe </li>
</ul>
</li>
<li>Check CVMFS config status.<ul>
<li>cvmfs_config stat -v oasis.opensciencegrid.org</li>
</ul>
</li>
</ol>
<h3 id="additional-documentation">Additional Documentation<a class="headerlink" href="#additional-documentation" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://cvmfs.readthedocs.io/en/stable/">CERN's CVMFS Documentation</a></li>
<li><a href="https://opensciencegrid.github.io/docs/other/install-cvmfs-stratum1/">OSG's CVMFS Replica Server</a></li>
<li><a href="https://opensciencegrid.github.io/docs/worker-node/install-cvmfs/">OSG's CVMFS Client Documentation</a></li>
<li>
<p><a href="https://opensciencegrid.github.io/docs/data/external-oasis-repos/">OSG's OASIS Documentation</a></p>
</li>
<li>
<p><a href="../bash_pi.sh">bash_pi.sh</a>: A bash script that uses a simple Monte Carlo method to estimate the value of Pi</p>
</li>
</ul>
<h2 id="gratia-probe">Gratia Probe<a class="headerlink" href="#gratia-probe" title="Permanent link">&para;</a></h2>
<p>This section documents the testing procedure to test the gratia probes sufficiently tested to be promoted to the osg-testing repository. The test procedure is the same on both SL6 and SL7.</p>
<ul>
<li>install or update the <code>gratia-probe-condor</code> rpm as appropriate</li>
<li>On each VM download the gratia-probe-setup.sh script and run it</li>
<li>In <code>/etc/gratia/condor/ProbeConfig</code>, verify the following have been changed:<ul>
<li>change <code>SiteName</code> to something aside from <code>Generic Site</code></li>
<li>change <code>EnableProbe</code> to 1</li>
<li>change <code>CollectorHost</code>, <code>SSLHost</code>, and <code>SSLRegistrationHost</code> to the an invalid host (E.g. test.com) or the localhost</li>
</ul>
</li>
<li>Create <code>/var/lib/osg/</code> and download the attached <code>user-vo-map</code> file and place it in that directory</li>
<li>Edit the <code>user-vo-map</code> file and change the account from <code>sthapa</code> to the account you'll be using to submit the condor jobs in the following step</li>
<li>Download and submit the attached condor_submit file (note, on the default fermicloud VM, this takes about 3 hours, so you may want to set <code>NUM_CPUS</code> to 50 so that 50 jobs will run at a time)</li>
<li>Run <code>/usr/share/gratia/condor/condor_meter</code></li>
<li>Check <code>/var/lib/gratia/tmp/gratiafiles/</code> for a <code>subdir.condor_...</code> directory and verify that there are 200 xml jobs and the cpus/wall times are appropriate (either PT0S or PT1M).</li>
</ul>
<h2 id="gsi-openssh">GSI OpenSSH<a class="headerlink" href="#gsi-openssh" title="Permanent link">&para;</a></h2>
<p>To test a fresh installation:</p>
<ol>
<li>Spin up two VM's and set up the EPEL/OSG repos on both of them.</li>
<li>Choose one of the VM's, it will be the server VM. Consult these <a href="https://opensciencegrid.github.io/docs/other/gsissh/">instructions</a> to set up the server.</li>
<li>
<p>From the other VM (client):</p>
<ol>
<li>
<p>Install the necessary packages:</p>
<div class="codehilite"><pre><span></span><span class="gp">root@host #</span> yum install globus-proxy-utils gsi-openssh-clients
</pre></div>


</li>
<li>
<p>Initialize your proxy. After this, none of the gsi commands should prompt you for your password.</p>
</li>
<li>
<p>Connect to the server:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@host $</span> gsissh -p <span class="m">2222</span> <span style="color:red">&lt;server hostname&gt;</span>
</pre></div>


</li>
<li>
<p>Copy a test file to the server:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@host $</span> gsiscp -p <span class="m">2222</span> testfile <span style="color:red">&lt;server hostname&gt;</span>:/tmp
</pre></div>


</li>
<li>
<p>Connect to the server via SFTP and grab files:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@host $</span> gsisftp -P <span class="m">2222</span> <span style="color:red">&lt;server hostname&gt;</span>
<span class="gp">user@host $</span> <span class="nb">cd</span> /tmp
<span class="gp">user@host $</span> get testfile
</pre></div>


</li>
</ol>
</li>
</ol>
<h2 id="htcondor-ce-collector-wip">HTCondor-CE Collector (WIP)<a class="headerlink" href="#htcondor-ce-collector-wip" title="Permanent link">&para;</a></h2>
<p>The CE Collector is a stripped-down version of HTCondor-CE that contains mostly just the collector daemon and configs. It was introduced in htcondor-ce-1.6. The production CE Collectors run at the GOC, but you may want to set up your own for testing.</p>
<ol>
<li>Make 2 VMs with the EPEL/OSG repos installed: one for the collector, and one for the CE</li>
</ol>
<h3 id="setting-up-the-collector">Setting Up the Collector<a class="headerlink" href="#setting-up-the-collector" title="Permanent link">&para;</a></h3>
<ol>
<li>Install <code>htcondor-ce-collector</code></li>
<li>
<p>Create a file called <code>/etc/condor-ce/config.d/99-local.conf</code> that contains this line:<pre class='file'></p>
<div class="codehilite"><pre><span></span>COLLECTOR.ALLOW_ADVERTISE_SCHEDD = $(COLLECTOR.ALLOW_ADVERTISE_SCHEDD), your_htcondor_ce_host.example.net&lt;/pre&gt;
</pre></div>


<p>(with <code>your_htcondor_ce_host</code> replaced by the hostname the HTCondor-CE VM)</p>
</li>
<li>
<p>Run <code>service condor-ce-collector start</code></p>
</li>
</ol>
<h3 id="setting-up-the-ce">Setting Up the CE<a class="headerlink" href="#setting-up-the-ce" title="Permanent link">&para;</a></h3>
<ol>
<li>Install <code>osg-htcondor-ce-condor</code> (replace condor with the batch system of your choice)</li>
<li>Ensure osg-configure &gt;= 1.0.60-2 is installed</li>
<li>
<p>Configure your CE using osg-configure</p>
<ol>
<li>You should use the <a href="https://opensciencegrid.github.io/docs/compute-element/install-htcondor-ce/">HTCondor-CE Install Docs</a> as a reference, although you can skip several of the steps</li>
<li>You can skip setting up Squid: set <code>enabled</code> to <code>True</code> and <code>location</code> to <code>UNAVAILABLE</code> in <code>01-squid.ini</code></li>
<li>Set <code>htcondor_gateway_enabled</code> to <code>True</code> in <code>10-gateway.ini</code></li>
<li>You probably don't need GUMS, but if you want it, use the Fermi GUMS server (set <code>gums_host</code> to <code>gums.fnal.gov</code> and <code>authorization_method</code> to <code>xacml</code> in 10-misc.ini)</li>
<li>
<p>To keep osg-configure from complaining about storage, edit <code>10-storage.ini</code>:</p>
<ul>
<li>Set <code>se_available</code> to <code>False</code></li>
<li>Set <code>app_dir</code> to <code>/osg/app_dir</code></li>
<li>Set <code>data_dir</code> to <code>/osg/data_dir</code></li>
<li>Do <code>mkdir -p /osg/app_dir/etc; mkdir -p /osg/data_dir; chmod 1777 /osg/app_dir{,/etc}</code></li>
</ul>
</li>
<li>
<p>Enable your batch system by setting <code>enabled</code> to <code>True</code> in <code>20-&lt;batch system&gt;.ini</code></p>
</li>
<li>Set up the site info in <code>40-siteinfo.ini</code> ; in particular, you'll need to set the <code>resource</code> and <code>resource_group</code> settings
    \ (you just need to pick a name; I concatenate my login name with the short host name and use that, e.g. matyasfermicloud001).
    \ You can also use the following settings:<ul>
<li><code>group=OSG-ITB</code></li>
<li><code>sponsor=local</code></li>
<li><code>city=Batavia, IL</code></li>
<li><code>country=US</code></li>
<li><code>longitude=-88</code></li>
<li><code>latitude=41</code></li>
</ul>
</li>
</ol>
</li>
<li>
<p>Edit the file <code>/etc/osg/config.d/30-infoservices.ini</code> and set <code>ce_collectors</code> to the collector host</p>
</li>
<li>Run <code>osg-configure -dc</code></li>
<li>Start up your batch system</li>
<li>Run <code>service condor-ce start</code></li>
</ol>
<p>The CE will report to the collector host every five minutes. If you want to force it to send now, run <code>condor_ce_reconfig</code>. You should see your CE if you run <code>condor_ce_status -schedd</code> on the collector host.</p>
<h2 id="rsv">RSV<a class="headerlink" href="#rsv" title="Permanent link">&para;</a></h2>
<p>Testing a fresh installation:</p>
<ol>
<li>make sure the yum repositories required by OSG is installed on your host<ul>
<li>rpm -Uvh <a href="http://repo.grid.iu.edu/osg/3.2/osg-3.2-el6-release-latest.rpm">http://repo.grid.iu.edu/osg/3.2/osg-3.2-el6-release-latest.rpm</a> OR rpm -Uvh <a href="http://repo.grid.iu.edu/osg/3.2/osg-3.2-el5-release-latest.rpm">http://repo.grid.iu.edu/osg/3.2/osg-3.2-el5-release-latest.rpm</a></li>
<li>also make sure epel repo is set up. </li>
</ul>
</li>
<li>install the rpm<ul>
<li>yum --enablerepo=osg-testing install rsv </li>
</ul>
</li>
<li>edit /etc/osg/config.d/30-rsv.ini file<ul>
<li>in my case, I don't have a service cert for testing, so I use my own personal cert to create the proxy, but later on the owner of the proxy should be changed to "rsv" user that is created during the rpm install.</li>
<li>in the config file, for the ce_hosts and gridftp_hosts, put in a test server, as the result from this test will be uploaded to OSG GOC, which may mess up your production service monitoring if you chose a production server for the test.</li>
</ul>
</li>
<li>osg-configure -v</li>
<li>osg-configure -c</li>
<li>/etc/init.d/condor-cron start</li>
<li>/etc/init.d/rsv start</li>
<li>rsv-control --list</li>
<li>rsv-control --version</li>
<li>rsv-control --run --all-enabled 11. make sure the results from the above commands look fine.</li>
</ol>
<p>Testing an upgrade installation:</p>
<ol>
<li>make sure to enable the osg-testing repo, and set its priority higher than the other repos</li>
<li>yum --enablerepo=osg-testing upgrade rsv*</li>
<li>you can use the old 30-rsv.ini file for configuration</li>
<li>repeat steps 4)~11) as mentioned in the last section.</li>
</ol>
<h2 id="slurm">Slurm<a class="headerlink" href="#slurm" title="Permanent link">&para;</a></h2>
<p>This section goes through the steps needed to set up a slurm install on a VM. This is a necessary prerequisite for testing Slurm related components (CE integration, gratia, etc.). Note that the slurm setup used for this uses weak passwords for mysql. It should be sufficient for a quick setup, testing, and then tear down but should not be used without changes if it will be running for any appreciable length of time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>need to have a VM with 2+ GB of memory</p>
</div>
<h3 id="installation-and-setup">Installation and setup<a class="headerlink" href="#installation-and-setup" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Download scripts and config files: </p>
<div class="codehilite"><pre><span></span>cd /tmp/
git clone &lt;https://github.com/sthapa/utilities.git&gt;
cd utilities/slurm
</pre></div>


</li>
<li>
<p>setup and install slurm components</p>
<div class="codehilite"><pre><span></span>export username=&#39;USERNAME&#39; \# user that jobs will run as
export version=&#39;14.11.7&#39; \# slurm version to install (e.g. 16.05.2 or 14.11.7)
./slurm-setup.sh
</pre></div>


</li>
<li>
<p>After successful completion, slurm and slurm gratia probes should be setup and enabled.</p>
</li>
</ol>
<h3 id="running-a-job-using-slurm">Running a job using slurm<a class="headerlink" href="#running-a-job-using-slurm" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Generate test.sh with the following:</p>
<div class="codehilite"><pre><span></span>#/bin/bash
echo &quot;In the directory: `pwd`&quot; echo &quot;As the user: `whoami`&quot; echo “Hostname:&quot; /bin/hostname sleep 60 &lt;/pre&gt;
</pre></div>


</li>
<li>
<p>run <code>sbatch test.sh</code></p>
</li>
<li>the output from the jobs should appear in the current working directory as <code>test.sh.[eo].nnnnn</code> where nnnnn is a job id</li>
</ol>
<h2 id="vo-client">VO Client<a class="headerlink" href="#vo-client" title="Permanent link">&para;</a></h2>
<p>This document contains a basic recipe for testing a VO Package release</p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<p>Testing the VO package requires a few components:
   * X.509 certificate with membership to at least one VO
   * System with working GUMS installation
   * System with OSG installation (voms-proxy-init and edg-mkgridmap)</p>
<h3 id="testing-voms-proxy-init">Testing <code>voms-proxy-init</code><a class="headerlink" href="#testing-voms-proxy-init" title="Permanent link">&para;</a></h3>
<p>Login in the system that has voms-proxy-init installed.  Make sure that you have the correct 
vo-client rpms installed and that your X.509 certificate is in your home directory.  For each
VO that you have membership in, run the following <code>voms-proxy-init -voms [VO]</code> where <code>[VO]</code> is 
the appropriate VO (e.g. osg, cms, etc.).  You should be able to generate a voms-proxy for that
VO without errors.</p>
<h3 id="testing-edg-mkgridmap">Testing <code>edg-mkgridmap</code><a class="headerlink" href="#testing-edg-mkgridmap" title="Permanent link">&para;</a></h3>
<p>Log on to a system with <code>edg-mkgridmap</code> installed.  Make sure you have the correct vo-client rpms 
installed (vo-client-edgmkgridmap).  Run <code>edg-mkgridmap</code> and check the log output for errors.<br />
There will be some errors so compare your errors with the errors on previous vo-package tickets to
make sure no new errors have appeared.</p>
<h3 id="testing-gums">Testing GUMS<a class="headerlink" href="#testing-gums" title="Permanent link">&para;</a></h3>
<p>Log on to a system with a working GUMS install.  Make sure that you have the correct vo-client 
rpms (osg-gums-config) installed.  </p>
<ol>
<li>Make a backup of <code>/etc/gums/gums.config</code> </li>
<li>Copy the mysql database information from <code>/etc/gums/gums.config</code> to <code>/etc/gums/gums.config.template</code></li>
<li>Copy <code>/etc/gums/gums.config.template</code> to <code>/etc/gums/gums.config</code></li>
<li>Start the <code>tomcat6</code> service </li>
<li>Go to the GUMS interface (e.g. https://my.host:8443/gums)</li>
<li>Go to the Update VO members page and click on the <code>update VO members</code> button</li>
<li>Once completed, there will probably be some errors.</li>
<li>Compare errors to errors on prior vo package update tickets and make sure no new errors have occurred. </li>
</ol>
<h2 id="voms-admin-server">VOMS Admin Server<a class="headerlink" href="#voms-admin-server" title="Permanent link">&para;</a></h2>
<h3 id="install-and-configure-voms-admin-server">Install and configure voms-admin-server<a class="headerlink" href="#install-and-configure-voms-admin-server" title="Permanent link">&para;</a></h3>
<p>Install and configure voms-admin-server with this <a href="../voms-install.sh">voms-install.sh</a> script, entering <code>osg-testing</code> when prompted for the <code>REPO</code> and your own e-mail address when prompted for <code>EMAIL_FROM</code>.</p>
<h3 id="set-up-test_vo-and-add-yourself-as-an-admin">Set up TEST_VO and add yourself as an admin<a class="headerlink" href="#set-up-test_vo-and-add-yourself-as-an-admin" title="Permanent link">&para;</a></h3>
<p>To add a test VO (named TEST_VO) and add yourself as an admin, use the following script, replacing the <code>USER_EMAIL</code>, <code>USER_CERT_SUBJECT</code>, and <code>USER_COMMON_NAME</code> variables with your own:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">VO_NAME</span><span class="o">=</span><span class="s2">&quot;TEST_VO&quot;</span>
<span class="nv">TOMCAT_PORT</span><span class="o">=</span><span class="s2">&quot;8443&quot;</span>
<span class="nv">USER_EMAIL</span><span class="o">=</span><span class="s2">&quot;YOUR_EMAIL&quot;</span>
<span class="nv">USER_CERT_SUBJECT</span><span class="o">=</span><span class="s2">&quot;YOUR CERT DN&quot;</span>
<span class="nv">USER_CERT_ISSUER</span><span class="o">=</span><span class="s2">&quot;/DC=com/DC=DigiCert-Grid/O=DigiCert Grid/CN=DigiCert Grid CA-1&quot;</span>
<span class="nv">USER_COMMON_NAME</span><span class="o">=</span><span class="s2">&quot;YOUR CERT CN&quot;</span>

voms-admin --vo <span class="nv">$VO_NAME</span> --host <span class="nv">$HOSTNAME</span> --nousercert create-user <span class="se">\</span>
    <span class="s2">&quot;</span><span class="nv">$USER_CERT_SUBJECT</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$USER_CERT_ISSUER</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$USER_COMMON_NAME</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$USER_EMAIL</span><span class="s2">&quot;</span>

voms-admin --vo <span class="nv">$VO_NAME</span> --host <span class="nv">$HOSTNAME</span> --nousercert assign-role <span class="se">\</span>
    /<span class="nv">$VO_NAME</span> VO-Admin <span class="s2">&quot;</span><span class="nv">$USER_CERT_SUBJECT</span><span class="s2">&quot;</span> <span class="s2">&quot;</span><span class="nv">$USER_CERT_ISSUER</span><span class="s2">&quot;</span>

<span class="nb">echo</span> web ui: https://<span class="nv">$HOSTNAME</span>:<span class="nv">$TOMCAT_PORT</span>/voms/<span class="nv">$VO_NAME</span>
</pre></div>


<h3 id="testing-the-web-ui">Testing the web UI<a class="headerlink" href="#testing-the-web-ui" title="Permanent link">&para;</a></h3>
<ol>
<li>Add/suspend/restore/delete a user (using your e-mail address for contact)</li>
<li>Verify e-mail receipt of suspension message</li>
</ol>
<h2 id="xrootd-voms-testing">XRootD VOMS Testing<a class="headerlink" href="#xrootd-voms-testing" title="Permanent link">&para;</a></h2>
<p>This section is intended for OSG Software/Release teams to gather information on testing vomsxrd/xrootd-voms-plugin package. Original plugin named <a href="http://gganis.github.io/vomsxrd/">vomsxrd</a>, similar to lcmaps that extracts information for authorization within xrootd of a proxy's voms extension.</p>
<p>You need an <a href="https://opensciencegrid.github.io/docs/data/install-xrootd/">xrootd server installation</a></p>
<p>In the xrootd server yum install the following packages:</p>
<ul>
<li>xrootd</li>
<li>xrootd-voms-plugin</li>
<li>vo-client</li>
</ul>
<p>In the xrootd client yum install the following packages:</p>
<ul>
<li>xrootd-client</li>
<li>voms-clients</li>
<li>vo-client</li>
</ul>
<p>In the xrootd server add this lines to file <code>/etc/xrootd/xrootd-clustered.cfg</code></p>
<div class="codehilite"><pre><span></span>xrootd.seclib /usr/lib64/libXrdSec.so
sec.protparm gsi -vomsfun:/usr/lib64/libXrdSecgsiVOMS.so -vomsfunparms:certfmt=raw|vos=cms|dbg -vomsat:2
sec.protocol /usr/lib64 gsi -ca:1 -crl:3
</pre></div>


<p>This configuration will only authorize members of VO <strong>cms</strong>. You can change it to another VO.</p>
<p>Make sure <code>fetch-crl</code> has been run otherwise the xrootd service may fail to start.</p>
<p>In the xrootd client get a proxy without voms extension or with another VO extension different that the one used in the configuration:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@host $</span> voms-proxy-init -voms mis
<span class="go">Enter GRID pass phrase:</span>
<span class="go">Your identity: /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</span>
<span class="go">Creating temporary proxy ........................... Done</span>
<span class="go">Contacting  voms.grid.iu.edu:15001 [/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=http/voms.grid.iu.edu] &quot;mis&quot; Done</span>
<span class="go">Creating proxy ............................................... Done</span>
<span class="gp">user@host $</span> xrdcp vomsxrdtest root://fermicloud024.fnal.gov:1094//tmp/
<span class="go">[0B/0B][100%][==================================================][0B/s]  </span>
<span class="go">Run: [FATAL] Auth failed</span>
</pre></div>


<p>Now get a proxy with cms extension and run it again:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@host $</span> voms-proxy-init -voms cms
<span class="go">Enter GRID pass phrase:</span>
<span class="go">Your identity: /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</span>
<span class="go">Creating temporary proxy ...................................... Done</span>
<span class="go">Contacting  voms2.cern.ch:15002 [/DC=ch/DC=cern/OU=computers/CN=voms2.cern.ch] &quot;cms&quot; Done</span>
<span class="go">Creating proxy .......................................... Done</span>
<span class="go">Your proxy is valid until Thu Dec  4 22:53:29 2014</span>
<span class="gp">user@host $</span> xrdcp vomsxrdtest root://fermicloud024.fnal.gov:1094//tmp/
<span class="go">[0B/0B][100%][==================================================][0B/s] </span>
</pre></div>


<h2 id="xrootd-plugins">XRootD Plugins<a class="headerlink" href="#xrootd-plugins" title="Permanent link">&para;</a></h2>
<h3 id="hadoop-name-node-installation">Hadoop name node installation<a class="headerlink" href="#hadoop-name-node-installation" title="Permanent link">&para;</a></h3>
<p>Use the following script with option 1:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">set</span> -e

<span class="k">select</span> NODETYPE in namenode datanode gridftp<span class="p">;</span> <span class="k">do</span>
  <span class="o">[[</span> <span class="nv">$NODETYPE</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">break</span>
<span class="k">done</span>
<span class="k">case</span> <span class="nv">$NODETYPE</span> in
  namenode <span class="o">)</span> <span class="nv">NAMENODE</span><span class="o">=</span><span class="nv">$HOSTNAME</span> <span class="p">;;</span>
         * <span class="o">)</span> <span class="nb">read</span> -p <span class="s1">&#39;hostname for NAMENODE? &#39;</span> NAMENODE <span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">echo</span> <span class="nv">NODETYPE</span><span class="o">=</span><span class="nv">$NODETYPE</span>
<span class="nb">echo</span> <span class="nv">NAMENODE</span><span class="o">=</span><span class="nv">$NAMENODE</span>
<span class="nb">read</span> -p <span class="s1">&#39;ok? [y/N] &#39;</span> ok
<span class="k">case</span> <span class="nv">$ok</span> in
  y*<span class="p">|</span>Y*<span class="o">)</span> <span class="p">;;</span>  <span class="c1"># ok</span>
      *<span class="o">)</span> <span class="nb">exit</span> <span class="p">;;</span>
<span class="k">esac</span>
<span class="c1">#yum install --enablerepo=osg-minefield osg-se-hadoop-$NODETYPE</span>
yum install osg-se-hadoop-<span class="nv">$NODETYPE</span>
<span class="k">case</span> <span class="nv">$NODETYPE</span> in
  namenode<span class="p">|</span>datanode <span class="o">)</span>
    mkdir -p /data/<span class="o">{</span>hadoop,scratch,checkpoint<span class="o">}</span>
    chown -R hdfs:hdfs /data
    sed -i s/NAMENODE/<span class="nv">$NAMENODE</span>/ /etc/hadoop/conf.osg/<span class="o">{</span>core,hdfs<span class="o">}</span>-site.xml
    cp /etc/hadoop/conf.osg/<span class="o">{</span>core,hdfs<span class="o">}</span>-site.xml /etc/hadoop/conf/
    touch /etc/hosts_exclude
    <span class="p">;;</span>
  gridftp <span class="o">)</span>
    ln -snf conf.osg /etc/hadoop/conf
    sed -i s/NAMENODE/<span class="nv">$NAMENODE</span>/ /etc/hadoop/conf.osg/<span class="o">{</span>core,hdfs<span class="o">}</span>-site.xml
    <span class="nb">echo</span> <span class="s2">&quot;hadoop-fuse-dfs# /mnt/hadoop fuse server=</span><span class="nv">$NAMENODE</span><span class="s2">,port=9000,rdbuffer=131072,allow_other 0 0&quot;</span> &gt;&gt; /etc/fstab
    mkdir /mnt/hadoop
    mount /mnt/hadoop
    cp -v /etc/redhat-release /mnt/hadoop/test-file
    sed -i <span class="s1">&#39;/globus_mapping/s/^# *//&#39;</span> /etc/grid-security/gsi-authz.conf
    sed -i s/yourgums.yourdomain/gums.fnal.gov/ /etc/lcmaps.db
    mkdir /mnt/hadoop/fnalgrid
    useradd fnalgrid -g fnalgrid
    chown fnalgrid:fnalgrid /mnt/hadoop/fnalgrid
    service globus-gridftp-server start
    <span class="k">if</span> <span class="nb">type</span> -t globus-url-copy &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
      globus-url-copy file:////bin/bash  gsiftp://<span class="nv">$HOSTNAME</span>/mnt/hadoop/fnalgrid/first_test
    <span class="k">else</span>
      <span class="nb">echo</span> globus-url-copy not installed
    <span class="k">fi</span>
    <span class="p">;;</span>
<span class="k">esac</span>
<span class="k">case</span> <span class="nv">$NODETYPE</span> in
  namenode <span class="o">)</span> su - hdfs -c <span class="s2">&quot;hadoop namenode -format&quot;</span> <span class="p">;;</span>
<span class="k">esac</span>
service hadoop-hdfs-<span class="nv">$NODETYPE</span> start
</pre></div>


<h3 id="hadoop-data-node-installation">Hadoop data node installation<a class="headerlink" href="#hadoop-data-node-installation" title="Permanent link">&para;</a></h3>
<ol>
<li>Run same script as before but with option number 2.</li>
<li>
<p>Install xrootd-server:</p>
<div class="codehilite"><pre><span></span>yum install xrootd-server
</pre></div>


</li>
<li>
<p>Install xrootd-plugins</p>
<div class="codehilite"><pre><span></span>yum install xrootd-cmstfc xrootd-hdfs
</pre></div>


</li>
</ol>
<h3 id="gridftp-installation">GridFTP installation<a class="headerlink" href="#gridftp-installation" title="Permanent link">&para;</a></h3>
<p>Run same as script but with option number.</p>
<h3 id="on-the-name-node">On the name node<a class="headerlink" href="#on-the-name-node" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="gp">[root@fermicloud092 ~]#</span> hdfs dfs -ls /test-file
<span class="go">Found 1 items</span>
<span class="go">-rw-r--r--   2 root root          0 2014-07-21 15:57 /test-file</span>
</pre></div>


<p>This means your hadoop is working.</p>
<p>Modify the file <code>/etc/xrootd/xrootd-clustered.cfg</code> to look like this:</p>
<div class="codehilite"><pre><span></span>xrd.port 1094

# The roles this server will play.                                                                                            
all.role server
all.role manager if xrootd.unl.edu
# The known managers                                                                                                          
all.manager srm.unl.edu:1213
#all.manager xrootd.ultralight.org:1213                                                                                       

# Allow any path to be exported; this is further refined in the authfile.                                                     
all.export / nostage

# Hosts allowed to use this xrootd cluster                                                                                    
cms.allow host *

### Standard directives                                                                                                       
# Simple sites probably don&#39;t need to touch these.                                                                            
# Logging verbosity                                                                                                           
xrootd.trace all -debug
ofs.trace all -debug
xrd.trace all -debug
cms.trace all -debug

# Integrate with CMS TFC, placed in /etc/storage.xml                                                                          
oss.namelib /usr/lib64/libXrdCmsTfc.so file:/etc/xrootd/storage.xml?protocol=hadoop

xrootd.seclib /usr/lib64/libXrdSec.so
xrootd.fslib /usr/lib64/libXrdOfs.so
ofs.osslib /usr/lib64/libXrdHdfs.so
all.adminpath /var/run/xrootd
all.pidpath /var/run/xrootd

cms.delay startup 10
cms.fxhold 60s
cms.perf int 30s pgm /usr/bin/XrdOlbMonPerf 30

oss.space default_stage /opt/xrootd_cache
</pre></div>


<p>Create file <code>/etc/xrootd/storage.xml</code> and place this:</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;storage-mapping&gt;</span>
<span class="nt">&lt;lfn-to-pfn</span> <span class="na">protocol=</span><span class="s">&quot;hadoop&quot;</span> <span class="na">destination-match=</span><span class="s">&quot;.*&quot;</span> <span class="na">path-match=</span><span class="s">&quot;.*/+tmp2/test-file&quot;</span> <span class="na">result=</span><span class="s">&quot;/test-file&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/storage-mapping&gt;</span>
</pre></div>


<p>For el7 the instrucctions are a little bit different. See:</p>
<p><a href="https://jira.opensciencegrid.org/browse/SOFTWARE-2198?focusedCommentId=334667&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-334667">https://jira.opensciencegrid.org/browse/SOFTWARE-2198?focusedCommentId=334667&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-334667</a></p>
<p>Now from a node do:</p>
<div class="codehilite"><pre><span></span><span class="go">xrdcp --debug 3 root://yourdatanode.yourdomain:1094//tmp2/test-file .</span>
</pre></div>


<p>If it is sucessful it would have tested both cmstfc and hdfs plugins </p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../policy/gums-retire/" class="btn btn-neutral float-right" title="GUMS Retirement">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../empty-pkgs/" class="btn btn-neutral" title="Empty Packages"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/technology" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../empty-pkgs/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../policy/gums-retire/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
