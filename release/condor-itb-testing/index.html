<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>HTCondor Prerelease Testing - OSG Technology Area</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "HTCondor Prerelease Testing";
    var mkdocs_page_input_path = "release/condor-itb-testing.md";
    var mkdocs_page_url = "/release/condor-itb-testing/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Technology Area</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
  
    <a class="" href="../..">Home</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Software</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../software/development-process/">Development Process</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/markdown-migration/">Migrating Documents to Markdown</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/koji-workflow/">Koji Workflow</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/new-team-member/">New Team Member</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/repository-management/">Repository Management</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/ce-test-scaling/">CE Scale Testing</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/rpm-development-guide/">RPM Development Guide</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/upcoming-to-main/">Upcoming to Main</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/software-support/">Software Support</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/effort-tracking/">Effort Tracking</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/release-planning/">Release Planning</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/globus-mass-update-procedure/">Globus Mass Update Procedure</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/git-software-development/">Git Software Development Process</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/osg-build-tools/">OSG Build Tools</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/resurrecting-epel-packages/">Resurrecting Epel Packages</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/koji-mass-rebuilds/">Koji Mass Rebuilds</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../software/create-vo-client/">Creating the VO Client Package</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Release</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../cut-sw-release/">How to Cut a Release</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../cut-data-release/">How to Cut a Data Release</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../release-policy/">Release Policy</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../release-schedule/">Release Schedule</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../new-release-series/">New Release Series</a>
  
        </li>
        <li class=" current">
          
  
    <a class="current" href="./">HTCondor Prerelease Testing</a>
  
  <ul class="subnav">
      
    <li class="toctree-l3"><a href="#testing-htcondor-prereleases-on-the-madison-itb-site">Testing HTCondor Prereleases on the Madison ITB Site</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#prerequisites">Prerequisites</a></li>
        
            <li><a class="toctree-l4" href="#gather-information">Gather Information</a></li>
        
            <li><a class="toctree-l4" href="#install-htcondor-prerelease">Install HTCondor Prerelease</a></li>
        
            <li><a class="toctree-l4" href="#run-tests">Run Tests</a></li>
        
        </ul>
    

  </ul>
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Policy</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../policy/gums-retire/">GUMS Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/bestman2-retire/">BeStMan2 Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/voms-admin-retire/">VOMS Admin Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/release-series/">Release Series Support</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/globus-toolkit/">Globus Toolkit Support</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Infrastructure</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-restore-recipe/">Koji Restore Recipe</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-hub-setup/">Koji-Hub Setup</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-inf-overview/">Koji Infrastructure Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-policy-writing/">Koji Policy Writing</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/madison-itb/">Madison ITB</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Documentation</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../documentation/writing-documentation/">Writing Documentation</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Historical Information</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-initial-install/">Koji Initial Install</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Historical Transitions</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../projects/sha2-support/">SHA-2 Support</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Technology Area</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Release &raquo;</li>
        
      
    
    <li>HTCondor Prerelease Testing</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/technology/edit/master/docs/release/condor-itb-testing.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="testing-htcondor-prereleases-on-the-madison-itb-site">Testing HTCondor Prereleases on the Madison ITB Site<a class="headerlink" href="#testing-htcondor-prereleases-on-the-madison-itb-site" title="Permanent link">&para;</a></h1>
<p>This document contains a basic recipe for testing an HTCondor prerelease build on the Madison ITB site.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>The following items are known prerequisites to using this recipe.  If you are not running the Ansible commands from
osghost, there are almost certainly other prerequisites that are not listed below.  And even using osghost for Ansible
and itb-submit for the submissions, there may be other prerequisites missing.  Please improve this document by adding
other prerequisites as they are identified!</p>
<ul>
<li>A checkout of the osgitb directory from our local git instance (not GitHub)</li>
<li>Your X.509 DN in the <code>osgitb/unmanaged/htcondor/condor_mapfile</code> file and (via Ansible) on <code>itb-ce1</code> and <code>itb-ce2</code></li>
</ul>
<h2 id="gather-information">Gather Information<a class="headerlink" href="#gather-information" title="Permanent link">&para;</a></h2>
<p>Technically skippable, this section is about checking on the state of the ITB machines before making changes.  The plan
is to keep the ITB machines generally up-to-date independently, so those steps are not listed here.  And honestly, the
steps below are just some ideas; do whatever makes sense for the given update.</p>
<p>The commands can be run as-is from within the <code>osgitb</code> directory from git.</p>
<ol>
<li>
<p>Check OS versions for all current ITB hosts:</p>
<div class="codehilite"><pre><span></span><span class="go">ansible current -i inventory -f 20 -o -m command -a &#39;cat /etc/redhat-release&#39;</span>
</pre></div>


</li>
<li>
<p>Check HTCondor versions for all HTCondor hosts:</p>
<div class="codehilite"><pre><span></span><span class="go">ansible condor -i inventory -f 20 -o -m command -a &#39;rpm -q condor&#39;</span>
</pre></div>


</li>
<li>
<p>Obtain the NVR of the HTCondor prerelease build from OSG to test.  Do this by talking to Tim&nbsp;T. and checking
   Koji.  The expectation is that the HTCondor prerelease build will be in the development repository (or
   upcoming-development).</p>
</li>
</ol>
<h2 id="install-htcondor-prerelease">Install HTCondor Prerelease<a class="headerlink" href="#install-htcondor-prerelease" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Shut down HTCondor and HTCondor-CE on prerelease machines:</p>
<div class="codehilite"><pre><span></span><span class="go">ansible condordev -i inventory -bK -f 20 -m service -a &#39;name=condor-ce state=stopped&#39; -l &#39;itb-ce*&#39;</span>
<span class="go">ansible condordev -i inventory -bK -f 20 -m service -a &#39;name=condor state=stopped&#39;</span>
</pre></div>


</li>
<li>
<p>Install new version of HTCondor on prerelease machines:</p>
<div class="codehilite"><pre><span></span><span class="go">ansible condordev -i inventory -bK -f 10 -m command -a &#39;yum --enablerepo=osg-development --assumeyes update condor&#39;</span>
</pre></div>


<p>or, if you need to install an NVR that is “earlier” (in the RPM sense) than what is currently installed:</p>
<div class="codehilite"><pre><span></span><span class="go">ansible condordev -i inventory -bK -f 10 -m command -a &#39;yum --enablerepo=osg-development --assumeyes downgrade condor condor-classads condor-python condor-procd blahp&#39;</span>
</pre></div>


</li>
<li>
<p>Verify installation of correct RPM version:</p>
<div class="codehilite"><pre><span></span><span class="go">ansible condor -i inventory -f 20 -o -m command -a &#39;rpm -q condor&#39;</span>
</pre></div>


</li>
<li>
<p>Restart HTCondor and HTCondor-CE on prerelease machines:</p>
<div class="codehilite"><pre><span></span><span class="go">ansible condordev -i inventory -bK -f 20 -m service -a &#39;name=condor state=started&#39;</span>
<span class="go">ansible condordev -i inventory -bK -f 20 -m service -a &#39;name=condor-ce state=started&#39; -l &#39;itb-ce*&#39;</span>
</pre></div>


</li>
</ol>
<h2 id="run-tests">Run Tests<a class="headerlink" href="#run-tests" title="Permanent link">&para;</a></h2>
<p>For the first two test workflows, use your personal space on <code>itb-submit</code>.  Copy or checkout the <code>osgitb/htcondor-tests</code>
directory to get the test directories.</p>
<h3 id="submitting-jobs-directly">Submitting jobs directly<a class="headerlink" href="#submitting-jobs-directly" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Change into the <code>1-direct-jobs</code> subdirectory</p>
</li>
<li>
<p>If there are old result files in the directory, remove them:</p>
<div class="codehilite"><pre><span></span><span class="go">make distclean</span>
</pre></div>


</li>
<li>
<p>Submit the test workflow</p>
<div class="codehilite"><pre><span></span><span class="go">condor_submit_dag test.dag</span>
</pre></div>


</li>
<li>
<p>Monitor the jobs until they are complete or stuck</p>
<p>In the initial test runs, the entire workflow ran in a few minutes.  If the DAG or jobs exit immediately, go on
hold, or otherwise fail, then you have some troubleshooting to do!  Keep trying steps 2 and 3 until you get a clean
run (or one or more HTCondor bug tickets).</p>
</li>
<li>
<p>Check the final output file:</p>
<div class="codehilite"><pre><span></span><span class="go">cat count-by-hostnames.txt</span>
</pre></div>


<p>You should see a reasonable distribution of jobs by hostname, keeping in mind the different number of cores per
machine and the fact that HTCondor can and will reuse claims to process many jobs on a single host.  Especially
watch out for a case in which no jobs run on the newly updated hosts (at the time of writing: <code>itb-data[456]</code>).</p>
</li>
<li>
<p>(Optional) Clean up, using the <code>make clean</code> or <code>make distclean</code> commands.</p>
</li>
</ol>
<h3 id="submitting-jobs-using-htcondor-c">Submitting jobs using HTCondor-C<a class="headerlink" href="#submitting-jobs-using-htcondor-c" title="Permanent link">&para;</a></h3>
<p>If direct submissions fail, there is probably no point to doing this step.</p>
<ol>
<li>
<p>Change into the <code>2-htcondor-c-jobs</code> subdirectory</p>
</li>
<li>
<p>If there are old result files in the directory, remove them:</p>
<div class="codehilite"><pre><span></span><span class="go">make distclean</span>
</pre></div>


</li>
<li>
<p>Get a proxy for your X.509 credentials</p>
<div class="codehilite"><pre><span></span><span class="go">voms-proxy-init</span>
</pre></div>


</li>
<li>
<p>Submit the test workflow</p>
<div class="codehilite"><pre><span></span><span class="go">condor_submit_dag test.dag</span>
</pre></div>


</li>
<li>
<p>Monitor the jobs until they are complete or stuck</p>
<p>In the initial test runs, the entire workflow ran in 10 minutes or less; generally, this test takes longer than the
direct submission test, because of the layers of indirection.  Also, status updates from the CEs back to the submit
host are infrequent.  For direct information about the CEs, log in to <code>itb-ce1</code> and <code>itb-ce2</code> to check status; don’t
forget to check both <code>condor_ce_q</code> and <code>condor_q</code> on the CEs, probably in that order.</p>
<p>If the DAG or jobs exit immediately, go on hold, or otherwise fail, then you have some troubleshooting to do!  Keep
trying steps 2 and 3 until you get a clean run (or one or more HTCondor bug tickets).</p>
</li>
<li>
<p>Check the final output file:</p>
<div class="codehilite"><pre><span></span><span class="go">cat count-by-hostnames.txt</span>
</pre></div>


<p>Again, look for a reasonable distribution of jobs by hostname.</p>
</li>
<li>
<p>(Optional) Clean up, using the <code>make clean</code> or <code>make distclean</code> commands.</p>
</li>
</ol>
<h3 id="submitting-jobs-from-a-glideinwms-vo-frontend">Submitting jobs from a GlideinWMS VO Frontend<a class="headerlink" href="#submitting-jobs-from-a-glideinwms-vo-frontend" title="Permanent link">&para;</a></h3>
<p>For this workflow, use your personal space on <code>glidein3.chtc.wisc.edu</code>.  Copy or checkout the <code>osgitb/htcondor-tests</code>
directory to get the test directories.  Again, if previous steps fail, do not bother with this step.</p>
<ol>
<li>
<p>Change into the <code>3-frontend-jobs</code> subdirectory</p>
</li>
<li>
<p>If there are old result files in the directory, remove them:</p>
<div class="codehilite"><pre><span></span><span class="go">make distclean</span>
</pre></div>


</li>
<li>
<p>Submit the test workflow</p>
<div class="codehilite"><pre><span></span><span class="go">condor_submit_dag test.dag</span>
</pre></div>


</li>
<li>
<p>Monitor the jobs until they are complete or stuck</p>
<p>This workflow could take much longer than the first two, maybe an hour or so.  Also, unless there are active
glideins, it will take 10 minutes or longer for the first glideins to appear and start matching jobs.  Thus it is
helpful to monitor <code>condor_q -totals</code> until all of the jobs are submitted (there should be 2001), then switch to
monitoring <code>condor_status</code> until glideins start appearing.  After the first jobs start running and finishing, it is
probably safe to ignore the rest of the run.  If the jobs do not appear in the local queue, if glideins do not
appear, or if jobs do not start running on the glideins, it is time to start troubleshooting.</p>
</li>
<li>
<p>Check the final output file:</p>
<div class="codehilite"><pre><span></span><span class="go">cat count-by-hostnames.txt</span>
</pre></div>


<p>The distribution of jobs per execute node may be more skewed than in the first two workflows, due to the way in
which pilots ramp up over time and how HTCondor allocates jobs to slots.</p>
</li>
<li>
<p>(Optional) Clean up, using the <code>make clean</code> or <code>make distclean</code> commands.</p>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../policy/gums-retire/" class="btn btn-neutral float-right" title="GUMS Retirement">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../new-release-series/" class="btn btn-neutral" title="New Release Series"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/technology" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../new-release-series/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../policy/gums-retire/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
