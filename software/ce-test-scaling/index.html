<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>CE Scale Testing - OSG Technology Area</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "CE Scale Testing";
    var mkdocs_page_input_path = "software/ce-test-scaling.md";
    var mkdocs_page_url = "/software/ce-test-scaling/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> OSG Technology Area</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
  
    <a class="" href="../..">Home</a>
  
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Software</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../development-process/">Development Process</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../markdown-migration/">Migrating Documents to Markdown</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../koji-workflow/">Koji Workflow</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../new-team-member/">New Team Member</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../repository-management/">Repository Management</a>
  
        </li>
        <li class=" current">
          
  
    <a class="current" href="./">CE Scale Testing</a>
  
  <ul class="subnav">
      
    <li class="toctree-l3"><a href="#how-to-run-scalability-tests-on-a-ce">How to Run Scalability Tests on a CE</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#introduction">Introduction</a></li>
        
            <li><a class="toctree-l4" href="#sleeper-pool">Sleeper Pool</a></li>
        
            <li><a class="toctree-l4" href="#usual-topology-of-the-tests">Usual Topology of the Tests</a></li>
        
            <li><a class="toctree-l4" href="#monitoring-tools">Monitoring tools</a></li>
        
            <li><a class="toctree-l4" href="#generating-load">Generating Load</a></li>
        
        </ul>
    

  </ul>
        </li>
        <li class="">
          
  
    <a class="" href="../rpm-development-guide/">RPM Development Guide</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../upcoming-to-main/">Upcoming to Main</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/software-support/">Software Support</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../effort-tracking/">Effort Tracking</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../release-planning/">Release Planning</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Release</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../release/cut-sw-release/">How to Cut a Release</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/cut-data-release/">How to Cut a Data Release</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/release-policy/">Release Policy</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../release/release-schedule/">Release Schedule</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Policy</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../policy/gums-retire/">GUMS Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/bestman2-retire/">BeStMan2 Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/voms-admin-retire/">VOMS Admin Retirement</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/release-series/">Release Series Support</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../policy/globus-toolkit/">Globus Toolkit Support</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Infrastructure</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-restore-recipe/">Koji Restore Recipe</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-hub-setup/">Koji-Hub Setup</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-inf-overview/">Koji Infrastructure Overview</a>
  
        </li>
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-policy-writing/">Koji Policy Writing</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Documentation</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../documentation/writing-documentation/">Writing Documentation</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Historical Information</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../infrastructure/koji-initial-install/">Koji Initial Install</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  <span class="caption-text">Historical Transitions</span>
  <ul class="subnav">
        <li class="">
          
  
    <a class="" href="../../projects/sha2-support/">SHA-2 Support</a>
  
        </li>
  </ul>
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
            <li class="toctree-l1">
		
  
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">OSG Technology Area</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Software &raquo;</li>
        
      
    
    <li>CE Scale Testing</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/opensciencegrid/technology/edit/master/docs/software/ce-test-scaling.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="how-to-run-scalability-tests-on-a-ce">How to Run Scalability Tests on a CE<a class="headerlink" href="#how-to-run-scalability-tests-on-a-ce" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This document is intended as a general overview of the process for scalability testing of an OSG CE (Compute Element). All examples are for testing an <a href="https://twiki.grid.iu.edu/bin/view/Trash/Trash/Sandbox/HTCondorCEScaleTests">HTCondor-CE</a>, but they should be applicable for other CE software.</p>
<p>The focus of testing a CE is on the number of concurrent running jobs the CE can sustain as well as the ramp-up rate when many jobs are queued.</p>
<h2 id="sleeper-pool">Sleeper Pool<a class="headerlink" href="#sleeper-pool" title="Permanent link">&para;</a></h2>
<p>With the focus on the CE, actual job payloads can be minimal – simple long sleep jobs are fine. Thus, then can run on nearly any resources, and it is even possible to allow far more of these jobs to run on a single resource than would be sensible for real jobs.</p>
<p>When large-scale testing a CE, one of the objectives is to see if the CE can fully utilize all resources (cores) available to it or if there are bottlenecks preventing that outcome. However to do this would normally require using up production slots, and it is hard to find a site willing to give up so many production slots for so long. Thus, running resourceless jobs in parallel with production jobs allows the testing to proceed without interfering with real work.</p>
<h3 id="setting-up-a-sleeper-pool">Setting Up a Sleeper Pool<a class="headerlink" href="#setting-up-a-sleeper-pool" title="Permanent link">&para;</a></h3>
<p>A sleeper pool is created by “tricking” a worker node into thinking it has more cores than physically available. Then, the host is configured so that jobs marked for the sleeper pool are routed to the extra slots. In HTCondor, this is done by changing the START expression on each startd. For example, on a 32-core machine:</p>
<div class="codehilite"><pre><span></span>START = ( \
          (SlotID &gt;= 1) &amp;&amp; \
          (SlotID &lt; 33) &amp;&amp; \
          (RequiresWholeMachine =!= TRUE ) &amp;&amp; \
          (SleepSlot =!= TRUE) &amp;&amp; \
          (distro =?= &quot;RHEL6&quot; ) &amp;&amp; \
          (CPU_Only == TRUE ) \
          ) || \
          ( (SlotID &gt;= 33) &amp;&amp; (distro =?= &quot;RHEL6&quot; ) &amp;&amp; (SleepSlot == TRUE) )
</pre></div>


<h2 id="usual-topology-of-the-tests">Usual Topology of the Tests<a class="headerlink" href="#usual-topology-of-the-tests" title="Permanent link">&para;</a></h2>
<p>A brief introduction to the topology involved in the tests.</p>
<h3 id="batch-system-and-sleeper-pool">Batch System and Sleeper Pool<a class="headerlink" href="#batch-system-and-sleeper-pool" title="Permanent link">&para;</a></h3>
<p>This is normally the batch system of the resources which will be behind the CE to be tested. It is normally set up by a site administrator.</p>
<h3 id="ce">CE<a class="headerlink" href="#ce" title="Permanent link">&para;</a></h3>
<p>This is the physical hardware where the CE software runs, hopefully mimicking real production hardware specifications.</p>
<h3 id="submitter">Submitter<a class="headerlink" href="#submitter" title="Permanent link">&para;</a></h3>
<p>An HTCondor submit host. It can be a virtual machine for most test submissions.</p>
<h2 id="monitoring-tools">Monitoring tools<a class="headerlink" href="#monitoring-tools" title="Permanent link">&para;</a></h2>
<p>To monitor tests, two software components are needed (which can be installed on the same node): ganglia-gmond and ganglia-gmetad. Once they are installed, then some ad-hoc metrics can be created to monitor the CE; for example:</p>
<div class="codehilite"><pre><span></span><span class="go">condor_q -pool red.unl.edu:9619 -name sleeper@red.unl.edu -const &#39;JobStatus=?=2&#39; | wc -l</span>
<span class="go">gmetric --name RunningJobsCE </span>
</pre></div>


<h2 id="generating-load">Generating Load<a class="headerlink" href="#generating-load" title="Permanent link">&para;</a></h2>
<h3 id="location">Location<a class="headerlink" href="#location" title="Permanent link">&para;</a></h3>
<p>The load_generators are found in the  <a href="https://github.com/efajardo/osgscal">OSgscal github repo</a>. The binary of interest here is <code>loadtest_condor</code></p>
<h3 id="use">Use<a class="headerlink" href="#use" title="Permanent link">&para;</a></h3>
<p>Just untar it or check it out from mas on the HTCondor submit node (see above):</p>
<div class="codehilite"><pre><span></span><span class="go">git checkout https://github.com/efajardo/osgscal</span>
<span class="go">cd load_generators/loadtest_condor/trunk/bin</span>
</pre></div>


<p>Keep in mind that you also need a valid proxy for grid submissions.</p>
<p>For example, if the goal is to keep 1,000 jobs in the queue and run 6-hour sleep jobs (on average), you can run this command:</p>
<div class="codehilite"><pre><span></span><span class="go">./loadtest_condor.sh -type grid condor sleeper@red.unl.edu red.unl.edu:9619 -jobs 40000 -cluster 10 -proxy /home/submituser/.globus/cmspilot01.proxy -end random 21600 -maxidle 1000 -in sandbox 50</span>
</pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../rpm-development-guide/" class="btn btn-neutral float-right" title="RPM Development Guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../repository-management/" class="btn btn-neutral" title="Repository Management"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/opensciencegrid/technology" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../repository-management/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../rpm-development-guide/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
